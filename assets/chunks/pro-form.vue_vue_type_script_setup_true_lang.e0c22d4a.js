import{n as g,W as v,aq as B,o as C,c as M,u as w,a,r as n,F as D,b as y,ar as R,as as S}from"../app.5ad9d4dc.js";function i(u){return typeof u=="function"||Object.prototype.toString.call(u)==="[object Object]"&&!S(u)}var L={__name:"pro-form",props:{modelValue:{type:Object,default:()=>({})},fields:{type:Array,default:()=>[]},rules:{type:Object,default:()=>({})},isQuery:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(u,{expose:h,emit:F}){const{modelValue:s,fields:f,rules:_,isQuery:k}=u;let p=g({}),b=g(null),V=v(()=>f.filter(e=>!e.hidden)),m=v(()=>f.reduce((e,t)=>(t.groups?t.groups.forEach(l=>{e.push(l)}):e.push(t),e),[])),x=(e,t)=>Object.keys(e).filter(l=>!t.includes(l)).reduce((l,o)=>(l[o]=e[o],l),{}),j=()=>m.value.reduce((e,t)=>{let l=s[t.prop]||"";return s[t.prop]!==void 0?e[t.prop]=s[t.prop]:(t.component==="checkbox-group"||t.component==="select"&&t.multiple||t.component==="tree-select"&&t.multiple||t.component==="date-picker"&&t.type==="daterange"?l=[]:(t.component==="slider"||t.component==="input-number")&&(l=0),e[t.prop]=l),e},{});p.value=j(),B(()=>p,e=>{let t={};if(!m.value.some(o=>["daterange"].includes(o.type)))t=e.value;else{let o=m.value.find(N=>N.type==="daterange"),r=o.propsMap,c=r[0],I=r[1];t={...e.value,[c]:e.value[o.prop][0],[I]:e.value[o.prop][1]},t=x(t,[o.prop])}F("update:modelValue",t)},{deep:!0});let O=()=>{let e;return a(n("el-form"),{model:p,rules:_,inline:!0,class:"pro-form"},i(e=P())?e:{default:()=>[e]})},P=()=>a(n("el-row"),null,{default:()=>[V.value.map(e=>{if(e.span){let t;return a(n("el-col"),{span:e.span},i(t=d(e))?t:{default:()=>[t]})}return d(e)}),k&&a(D,null,[a(n("el-button"),null,{default:()=>[y("\u67E5\u8BE2")]}),a(n("el-button"),null,{default:()=>[y("\u91CD\u7F6E")]})])]}),d=e=>{if(e.groups&&e.groups.length){let t;return a(n("el-card"),{header:e.title},i(t=e.groups.map(l=>d(l)))?t:{default:()=>[t]})}else{let{component:t,options:l,...o}=e,r="el-"+e.component;return t=n(r),a(n("el-form-item"),{label:e.label,prop:e.prop},{default:()=>[a(t,R({modelValue:p.value[e.prop],"onUpdate:modelValue":c=>p.value[e.prop]=c},o),{default:()=>[l&&l.length&&E(e,l)]})]})}},E=(e,t)=>{let l="";e.component==="select"?l="el-option":e.component==="checkbox-group"?l="el-checkbox":e.component==="radio-group"&&(l="el-radio");let o=n(l);return t.map(r=>e.component==="checkbox-group"||e.component==="radio-group"?a(o,{label:r.value,key:r.value},{default:()=>[r.label]}):a(o,{label:r.label,value:r.value,key:r.value},null))};return h({validate:async()=>new Promise(e=>{b.value.validate(t=>{t&&e(t)})}),resetFields:()=>{b.value.resetFields()}}),(e,t)=>(C(),M(w(O)))}};export{L as _};
